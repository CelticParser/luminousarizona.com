{% assign gid = null %}

{% if env.GOOGLE_ANALYTICS_ID %}
  {% assign gid = env.GOOGLE_ANALYTICS_ID %}
{% elsif site.analytics.google_analytics_id and site.analytics.google_analytics_id != '' %}
  {% assign gid = site.analytics.google_analytics_id %}
{% endif %}

{% capture cookie_banner_controlled %}
  {% if site.cookie_banner.enabled %}data-cookiecategory="analytics" type="text/plain"{% endif %}
{% endcapture %}

{% if gid %}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ gid }}" {{cookie_banner_controlled}}></script>
  <script {{cookie_banner_controlled}}>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', '{{ gid }}');
  </script>
{% endif  %}